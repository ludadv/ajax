<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AJAX</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
</head>
<body>

<div class="block">
</div>

<style>
    .block {
        display: flex;
        flex-direction: column;
        margin: 0 auto;
        width: 500px;
        min-height: 200px;
        background-color: #fff;
        text-align: center;
        padding: 20px 10px;
    }
    .title {
        text-transform: uppercase;
        padding: 10px;
    }
    .body {
        padding-bottom: 10px;
    }
    .hide {
        display: none;
    }
    .comments {
    }
    .post {
        width: 100%;
        min-height: 50px;
        border-radius: 5px;
        background-color: #a0a4a3;
        margin-bottom: 10px;
        padding-bottom: 10px;
    }
    .comment {
        width: 100%;
        min-height: 50px;
        border-radius: 5px;
        background-color: #04b88d;
        margin-bottom: 10px;
        padding-bottom: 10px;
    }
</style>

<script>
    $.ajax({
        url: "https://jsonplaceholder.typicode.com/posts",
    }).done(function(posts) {
        showPosts(posts);
    });

    function showPosts(posts) {
        posts.forEach(function(postItem) {
            $('.block').append('<div class="post">' +
                '<div class="title">'+ postItem.title + '</div>' +
                '<div class="body">'+ postItem.body + '</div>' +
                '<a href="#" class="toggle-comments"' +
                        ' data-id="' + postItem.id + '" data-toggle="0" data-loaded="0">Показать комментарии</a>' +
                '<div class="comments hide"></div>' +
            '</div>');
        });
    }

    $('.block').on('click', '.toggle-comments', function (event) { // Обработчик на динамически создаваемые ссылки
        event.preventDefault(); // Отключает переход по ссылке
        let $this = $(this);
        let commentsBlock = $this.closest('.post').find('.comments');

        if ($this.data('toggle') == 0) {
            $this.data('toggle', 1);
            commentsBlock.removeClass('hide');

            if ($this.data('loaded') == 0) {
                let postId = $this.data('id');

                $.ajax({
                    url: '//jsonplaceholder.typicode.com/posts/' + postId + '/comments',
                }).done(function(comments) {
                    $this.data('loaded', 1);

                    comments.forEach(function(commentItem) {
                        commentsBlock.append('<div class="comment">'+  commentItem.name + '</br>'
                                            + commentItem.email + '</br>'+  commentItem.body  + '</div>');
                    });
                })
            }
        } else {
            $this.data('toggle', 0);
            commentsBlock.addClass('hide');
        }
    });



    // function showPostsAndComments(posts, comments) {
    //     posts.forEach(function(postItem) {
    //         $('.block').append('<div class="title">'+ postItem.title + '</div>');
    //         $('.block').append('<div class="body">'+ postItem.body + '</div>');
    //
    //         comments.forEach(function(commentItem) {
    //             if (postItem.id == commentItem.postId) {
    //                 $('.block').append('<div class="comment">'+  commentItem.name + '</br>'
    //                     + commentItem.email + '</br>'+  commentItem.body  + '</div>');
    //             }
    //         });
    //     });
    // }
</script>

</body>

</html>
